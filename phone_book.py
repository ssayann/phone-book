def добавить_контакт(список_контактов, имя_фамилия, номер, комментарий):
    список_контактов.append({"Имя и Фамилия": имя_фамилия, "Номер телефона": номер, "Комментарий": комментарий})


def показать_контакты(список_контактов):
    print("| Имя и Фамилия | Номер телефона | Комментарий            |")
    print("|---------------|-----------------|------------------------|")
    for контакт in список_контактов:
        имя_фамилия = контакт.get('Имя и Фамилия', '')
        номер = контакт.get('Номер телефона', '')
        комментарий = контакт.get('Комментарий', '')
        print(f"| {имя_фамилия} | {номер} | {комментарий} |")


def сохранить_справочник(список_контактов, имя_файла="справочник.txt"):
    with open(имя_файла, "w", encoding="utf-8") as файл:
        for контакт in список_контактов:
            строка = f"{контакт['Имя и Фамилия']}, {контакт['Номер телефона']}, {контакт['Комментарий']}\n"
            файл.write(строка)


def открыть_справочник(список_контактов, имя_файла="справочник.txt"):
    try:
        with open(имя_файла, "r", encoding="utf-8") as файл:
            строки = файл.readlines()
            for строка in строки:
                имя_фамилия, номер, комментарий = строка.strip().split(", ")
                добавить_контакт(список_контактов, имя_фамилия, номер, комментарий)
        print("Справочник успешно открыт.")
    except FileNotFoundError:
        print("Файл справочника не найден.")


def создать_контакт(список_контактов):
    имя_фамилия = input("Введите имя и фамилию: ").strip()
    номер = input("Введите номер телефона: ").strip()
    комментарий = input("Введите комментарий: ").strip()
    добавить_контакт(список_контактов, имя_фамилия, номер, комментарий)
    print("Контакт успешно добавлен.")


def найти_контакт(список_контактов, запрос):
    найденные_контакты = [контакт for контакт in список_контактов if запрос.lower() in контакт.get("Имя и Фамилия", '').lower() or запрос in контакт.get("Номер телефона", '')]
    return найденные_контакты


def изменить_контакт(список_контактов, старое_имя):
    for контакт in список_контактов:
        if контакт.get("Имя и Фамилия", '') == старое_имя:
            print(f"Текущие данные контакта: {контакт}")
            print("Что вы хотите изменить?")
            print("1. Имя и Фамилию")
            print("2. Номер телефона")
            print("3. Комментарий")
            выбор = input("Введите номер действия: ")
            if выбор == "1":
                новое_имя = input("Введите новое имя и фамилию: ").strip()
                контакт["Имя и Фамилия"] = новое_имя
                print("Имя и фамилия успешно изменены.")
            elif выбор == "2":
                новый_номер = input("Введите новый номер телефона: ").strip()
                контакт["Номер телефона"] = новый_номер
                print("Номер телефона успешно изменен.")
            elif выбор == "3":
                новый_комментарий = input("Введите новый комментарий: ").strip()
                контакт["Комментарий"] = новый_комментарий
                print("Комментарий успешно изменен.")
            else:
                print("Неверный ввод. Пожалуйста, выберите действие от 1 до 3.")
            return
    print("Контакт не найден.")


def удалить_контакт(список_контактов, старое_имя):
    найденные_контакты = [контакт for контакт in список_контактов if контакт.get("Имя и Фамилия", '') == старое_имя]

    if not найденные_контакты:
        print("Контакт не найден.")
        return

    if len(найденные_контакты) > 1:
        print("Найдено несколько контактов с указанным именем:")
        for i, контакт in enumerate(найденные_контакты, 1):
            print(f"{i}. {контакт}")
        номер = int(input("Введите номер контакта, который вы хотите удалить: "))
        if 1 <= номер <= len(найденные_контакты):
            удаленный_контакт = найденные_контакты[номер - 1]
            список_контактов.remove(удаленный_контакт)
            print("Контакт успешно удален.")
        else:
            print("Неверный номер контакта.")
    else:
        контакт = найденные_контакты[0]
        список_контактов.remove(контакт)
        print("Контакт успешно удален.")

список_контактов = []
открыть_справочник(список_контактов)

while True:
    print("\nВыберите действие:")
    print("1. Открыть справочник")
    print("2. Сохранить справочник")
    print("3. Показать все контакты")
    print("4. Создать контакт")
    print("5. Найти контакт")
    print("6. Изменить контакт")
    print("7. Удалить контакт")
    print("8. Выход")

    выбор = input("Введите номер действия: ")

    if выбор == "1":
        открыть_справочник(список_контактов)
    elif выбор == "2":
        сохранить_справочник(список_контактов)
    elif выбор == "3":
        показать_контакты(список_контактов)
    elif выбор == "4":
        создать_контакт(список_контактов)
    elif выбор == "5":
        запрос = input("Введите имя, фамилию или номер телефона для поиска: ")
        найденные_контакты = найти_контакт(список_контактов, запрос)
        if найденные_контакты:
            print("Найденные контакты:")
            for контакт in найденные_контакты:
                print(контакт)
        else:
            print("Контакты не найдены.")
    elif выбор == "6":
        старое_имя = input("Введите имя и фамилию контакта, который вы хотите изменить: ")
        изменить_контакт(список_контактов, старое_имя)
    elif выбор == "7":
        имя_фамилия = input("Введите имя и фамилию контакта, который вы хотите удалить: ")
        удалить_контакт(список_контактов, имя_фамилия)
    elif выбор == "8":
        print("Выход из программы.")
        break
    else:
        print("Неверный ввод. Пожалуйста, выберите действие от 1 до 8.")
